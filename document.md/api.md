# CryptoWatchのAPIによるBTC価格データの取得と保存
api/ に存在するプログラムに関するドキュメント．

## getBTCprice.py
`python3 getBTCprice.py [period] [start/0] [end/0] [csvfile]`

### コマンドライン引数について
- period : データの間隔を指す．次のコマンドライン引数で指定する開始日から，
  - 1m : 1分ごと(1分足)
  - 5m : 5分ごと(5分足)
  - 1h : 1時間ごと(1時間足)
  - 4h : 4時間ごと(4時間足)
  - 1d : 1日(24時間)ごと(日足)
  - 1w : 1週間(7日)ごと(週足)

の価格データを取得する．

- start : 指定された日付から価格データを取得する．日付の形式はYYYY-mm-dd(2019年1月1日ならば2019-01-01)．このコマンドライン引数に，`0`を指定した場合は，現在DBに保存されている最新のデータを時刻が自動で設定される．

- end : 指定された日付までの価格データを取得する．日付の形式は`[start]`と同様．このコマンドライン引数に，`0`を指定した場合は，現在日時までの価格データが取得される．

- csvfile : 出力先のcsvファイルのディレクトリを指す．

### 使用上の注意
- およそ1年8ヶ月以前のデータは取得不可能．(APIの仕様?)
- およそ6000時点以前(1分ならおよそ6000分以上過去)のデータは取得不可能．(APIの仕様?)
- APIに送信するリクエストとしては，`start 00:00:00`から`end 00:00:00`までの価格データだが，データの間隔が`1m`，`5m`の場合は正しく取得できない．(`start 00:00:00`以前からのデータを取得し，`end 00:00:00`まで取得しきれない．)
- DBのユーザー・パスワード・DB名・テーブル名等は設計者により適宜変更し使用されるべきである．
- 取得する価格データは，取引所bitFlyerのものである．

## insertDB_add.py
`python3 insertDB_add.py [input_csvfiles] ...`

コマンドライン引数に，DBに挿入したい価格データが記載されているcsvファイル(複数可)のディレクトリを指定し実行すると，プログラム上で指定されたDBにデータが挿入される．

開発初期段階の名残で，str_str_period_str.csv(str : 任意の文字列，period : getBTCprice.pyのコマンドライン引数で指定するデータの間隔)形式のファイル名に対応しているが，使用時に合わせて適宜変更してもよい．

DB上の，getBTCprice.pyで指定されるデータの間隔ごとのテーブルに，csvファイルのデータが挿入される．

※このプログラムはDBの各データの間隔テーブル上に1つ以上のデータが存在する場合に動作する．初回挿入は後述するinsertDB_only_newdata.pyを使用のこと．

## insertDB_only_newdata.py
`python3 insertDB_only_newdata.py [input_csvfiles] ...`

使用方法はinsertDB_add.pyとほぼ同様であるが，このプログラムは初回データ挿入時に使用されるべきである．

## automation.sh
`sh automation.sh`

このスクリプトを実行すると，現在DBに存在する

- 1分ごと(1m)
- 5分ごと(5m)
- 1時間ごと(1h)
- 4時間ごと(4h)
- 1日ごと(1d)
- 1週間ごと(1w)

の最新のデータの時刻から，現在時刻までの各間隔の価格データが取得され，DBに挿入される．

